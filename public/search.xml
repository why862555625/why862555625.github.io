<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>5åˆ†é’Ÿæ­ä¸€ä¸ªhexoåšå®¢</title>
      <link href="/posts/b9dc5266.html"/>
      <url>/posts/b9dc5266.html</url>
      
        <content type="html"><![CDATA[<p>è¿™æ˜¯ä¸€ç¯‡åŸºç¡€æ•™ç¨‹ï¼Œç®€å•çš„æ­å»ºhexoåšå®¢</p><span id="more"></span><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/hexo.png" style="zoom:50%;" /><p><strong>hexo</strong>ä¹Ÿç®—æ˜¯è€ç‰Œåšå®¢æ¡†æ¶äº†ï¼Œä»¥å‰å¯¹äºhexoçš„äº†è§£ä¹Ÿä»…ä»…åœç•™åœ¨çŸ¥é“ä»–æ˜¯ä¸€ä¸ªèƒ½å¤Ÿå¿«é€Ÿå°†æœ¬åœ°çš„markdownæ–‡ä»¶ç”Ÿæˆé™æ€ç½‘ç«™çš„æ¡†æ¶ã€‚<br>æœ€æ—©çš„ä¸ªäººåšå®¢ç½‘ç«™è¿˜æ˜¯è‡ªå·±åŠ¨æ‰‹ï¼Œä»0-1çš„ä¸€ä¸ªspaï¼Œå¹¶åšäº†å¤§é‡seoï¼Œè®¾å¤‡é€‚é…ï¼Œæ€§èƒ½ä¼˜åŒ–ï¼Œé…å¥—å¼€å‘çš„æœåŠ¡ä¹ŸåŒ…æ‹¬åå°ç®¡ç†ç³»ç»Ÿï¼ŒnodeæœåŠ¡ä»¥åŠsqlæ•°æ®åº“ï¼Œå½“ç„¶ä¸ªäººè¿˜å…¼å¤‡äº§å“è®¾è®¡ï¼ŒUIè®¾è®¡ç­‰å·¥ä½œã€‚</p><p>å…¥å‘å°è¯•hexoæ˜¯ç”±äºçœ‹åˆ°hexoï¼š</p><ol><li>ä¸»é¢˜ä¸°å¯Œï¼Œä¸”å¤šç«¯é€‚é…è‰¯å¥½ã€‚</li><li>seoä¼˜åŒ–ï¼Œç½‘é¡µæ€§èƒ½ğŸ‘ğŸ»ã€‚</li><li>æ–¹ä¾¿ç®¡ç†ï¼Œè¿ç§»ã€‚</li></ol><h2 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h2><p>å‡†å¤‡å¥½åŸºæœ¬ç¯å¢ƒï¼š</p><ol><li>git</li><li>node</li></ol><p>ç›´æ¥å…¨å±€å®‰è£…hexo-cli</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo-cli</span><br></pre></td></tr></table></figure><p>è¿è¡Œæ£€æŸ¥æ˜¯å¦å®‰è£…å®Œæˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo version</span><br></pre></td></tr></table></figure><h2 id="cmdå¿«é€Ÿè¾…åŠ©å·¥å…·"><a href="#cmdå¿«é€Ÿè¾…åŠ©å·¥å…·" class="headerlink" title="cmdå¿«é€Ÿè¾…åŠ©å·¥å…·"></a>cmdå¿«é€Ÿè¾…åŠ©å·¥å…·</h2><ul><li><div class="flink"> <div class="flink-list">          <div class="flink-list-item">            <a href="/posts/db0a31c8/" title="å¿«é€Ÿè¾…åŠ©å·¥å…·" target="_blank">              <div class="flink-item-icon">                <img class="no-lightbox" src="http://q2.qlogo.cn/headimg_dl?dst_uin=1400000222&spec=640" onerror='this.onerror=null;this.src="https://unpkg.com/plasx@1.0.3/img/bj.webp"' alt="å¿«é€Ÿè¾…åŠ©å·¥å…·" />              </div>              <div class="flink-item-name">å¿«é€Ÿè¾…åŠ©å·¥å…·</div>               <div class="flink-item-desc" title="cmdå¿«é€Ÿè¾…åŠ©å·¥å…·">cmdå¿«é€Ÿè¾…åŠ©å·¥å…·</div>            </a>          </div></div></div></li></ul><p>æœ‰æ•ˆçš„å¿«é€Ÿå¼€å¯æœåŠ¡å…³é—­æœåŠ¡ï¼Œé¿å…æ¯æ¬¡éƒ½è¾“å…¥å‘½ä»¤çš„ç¹ç</p><h2 id="åˆå§‹åŒ–é¡¹ç›®"><a href="#åˆå§‹åŒ–é¡¹ç›®" class="headerlink" title="åˆå§‹åŒ–é¡¹ç›®"></a>åˆå§‹åŒ–é¡¹ç›®</h2><p>ä½¿ç”¨hero-cliåˆå§‹åŒ–blogé¡¹ç›®ï¼Œæˆ‘å–åå«â€lunaâ€å§ğŸŒ›ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init luna</span><br></pre></td></tr></table></figure><p>æ¥ç€å®‰è£…ä¾èµ–</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd luna</span><br><span class="line">npm install</span><br></pre></td></tr></table></figure><p>å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿è¡Œçœ‹ä¸‹æ•ˆæœã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure><p>æ‰“å¼€<code>http://localhost:4000/</code>æŸ¥çœ‹æ•ˆæœ</p><p><img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220703154230288.png" alt="image-20220703154230288"></p><p><strong>æ–‡ç« è¿ç§»</strong></p><p>æŠŠåŸå…ˆå†™è¿‡çš„markdownï¼Œcopyåˆ°source/_postsã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp -r /Users/allen/Documents/blog /User/allen/Desktop/luna/source/_posts</span><br></pre></td></tr></table></figure><blockquote><p>è¿™é‡Œæˆ‘æ²¡æ‰¾åˆ°å¦‚ä½•å¿«é€Ÿæ‰¹é‡é…ç½®front-matterçš„æ–¹å¼ï¼Œåªèƒ½æ‰‹åŠ¨ä¸€ä¸ªä¸€ä¸ªæ”¹äº†</p></blockquote><h2 id="é…ç½®-config-yml"><a href="#é…ç½®-config-yml" class="headerlink" title="é…ç½®_config.yml"></a>é…ç½®_config.yml</h2><p>Yamlè¯­è¨€çš„é…ç½®æ–‡ä»¶ï¼Œå¯¹ç½‘ç«™è¿›è¡Œè¯¦ç»†çš„è®¾ç½®ã€‚</p><p><a href="https://hexo.io/docs/configuration.html">https://hexo.io/docs/configuration.html</a></p><h2 id="å®‰è£…ä¸»é¢˜"><a href="#å®‰è£…ä¸»é¢˜" class="headerlink" title="å®‰è£…ä¸»é¢˜"></a>å®‰è£…ä¸»é¢˜</h2><p>é»˜è®¤çš„ä¸»é¢˜æœ‰ç‚¹ä¸‘ï¼Œå¯ä»¥åˆ°å®˜ç½‘æ‰¾ä¸‹å–œæ¬¢çš„ã€‚</p><p><a href="https://hexo.io/themes/">https://hexo.io/themes/</a></p><p>æˆ‘é€‰äº†Butterfly<br><a href="https://butterfly.js.org/">https://butterfly.js.org/</a></p><p>æŒ‰ç…§æç¤ºå®‰è£…é…ç½®å³å¯ã€‚</p><h2 id="å†™ä¸ªwebæœåŠ¡å™¨"><a href="#å†™ä¸ªwebæœåŠ¡å™¨" class="headerlink" title="å†™ä¸ªwebæœåŠ¡å™¨"></a>å†™ä¸ªwebæœåŠ¡å™¨</h2><p>ç›®å‰æˆ‘ä»¬å·²ç»å®Œæˆäº†hexoé¡¹ç›®çš„åˆå§‹åŒ–ï¼Œä½†hexoä»…æ˜¯ä¸€ä¸ªé™æ€é¡µé¢ç”Ÿæˆçš„æ¡†æ¶ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦éƒ¨ç½²åˆ°æœºå™¨ä¸Šï¼Œé‚£ä¹ˆè¿˜éœ€è¦ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p>expresså³å¯æ»¡è¶³æˆ‘æ‰€æœ‰éœ€æ±‚ã€‚</p><p>å®‰è£…expressï¼Œåœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ª<code>luna/www/index.js</code>ã€‚</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/** é™æ€èµ„æº */</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`app listening on port <span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å®‰è£…pm2ï¼Œæ·»åŠ scriptã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;logs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 logs&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ./www/index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 stop all&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>å…¶å®å¿«é€Ÿåœ¨æœºå™¨ä¸Šæ›´æ–°ä»£ç è¿˜æŒºéº»çƒ¦çš„ï¼Œå†å†™ä¸ªè„šæœ¬ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸšš æ‹‰å–æœ€æ–°ä»£ç ...&quot;</span></span><br><span class="line">git pull</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸš— æ›´æ–°npmåŒ…...&quot;</span></span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ“¦ï¸ æ‰“åŒ…å‰ç«¯ä»£ç ...&quot;</span></span><br><span class="line">npm run build</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸŒï¸ å¯åŠ¨wwwæœåŠ¡...&quot;</span></span><br><span class="line">npm run stop</span><br><span class="line">npm run start</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;ğŸ‰ğŸ‰ğŸ‰ éƒ¨ç½²æˆåŠŸ!!!&quot;</span></span><br></pre></td></tr></table></figure><p>æ”¾åœ¨<code>luna/script/deploy.sh</code>ï¼Œç„¶åå†åŠ ä¸ªscriptã€‚</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;scripts&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line"><span class="attr">&quot;logs&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 logs&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;start&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 start ./www/index.js&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;stop&quot;</span><span class="punctuation">:</span> <span class="string">&quot;pm2 stop all&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;deploy&quot;</span><span class="punctuation">:</span> <span class="string">&quot;sh ./script/deploy.sh&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure><p>æµ‹è¯•ä¸€ä¸‹ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run deploy</span><br></pre></td></tr></table></figure><p><img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721230920045.png" alt="image-20220721230920045"></p><p>çœ‹èµ·æ¥å¥½åƒæ²¡ä»€ä¹ˆé—®é¢˜ğŸ¤”</p><h2 id="æ­ä¸ªå›¾åºŠ"><a href="#æ­ä¸ªå›¾åºŠ" class="headerlink" title="æ­ä¸ªå›¾åºŠ"></a>æ­ä¸ªå›¾åºŠ</h2><p>åšå®¢é‡Œå›¾ç‰‡èµ„æºé‚£ä¹ˆå¤šï¼Œä½ çœ‹æˆ‘çš„1Mçš„å­¦ç”ŸæœåŠ¡å™¨æ€ä¹ˆæ‰›å¾—ä½å‘¢ï¼Ÿå›¾ç‰‡èµ„æºéƒ½ä¸ŠCDNå§ã€‚</p><p>æœ¬èº«æˆ‘ä¹Ÿä¹ æƒ¯æœ¬åœ°ç”¨Typoraå†™åšï¼Œé‚£ä¹ˆå°±æ¨èä¸€ä¸‹picGoåšå›¾åºŠç®¡ç†å§ï¼Œmacä½“éªŒæ»¡åˆ†ã€‚</p><p><img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231448819.png" alt="image-20220721231448819"></p><p><a href="https://picgo.github.io/PicGo-Doc/">PicGoå®˜ç½‘</a></p><p>æ”¯æŒçš„å›¾åºŠè¿˜è›®å¤šçš„ï¼ˆæˆ‘ç”¨COSï¼‰ï¼Œå…ˆé…ç½®å¥½ä½ çš„å›¾åºŠã€‚<img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231557705.png" alt="image-20220721231557705"></p><p>æ‰“å¼€Typoraåå¥½è®¾ç½®ï¼Œé…ç½®PicGOè‡ªåŠ¨ä¸Šä¼ ã€‚</p><p><img src="https://sls-cloudfunction-ap-guangzhou-code-1300044145.file.myqcloud.com/upload/image-20220721231756498.png" alt="image-20220721231756498"></p><p>è¯•è¯•åœ¨Typoraé‡Œç²˜è´´å›¾ç‰‡å§</p><h2 id="å®ç°è‡ªåŠ¨éƒ¨ç½²"><a href="#å®ç°è‡ªåŠ¨éƒ¨ç½²" class="headerlink" title="å®ç°è‡ªåŠ¨éƒ¨ç½²"></a>å®ç°è‡ªåŠ¨éƒ¨ç½²</h2><p>è‡ªåŠ¨éƒ¨ç½²ä½¿ç”¨æ–¹å¼æˆ‘å†™è¿›äº†ä»“åº“çš„README.mdäº†</p><p><a href="https://github.com/AHREAL/luna#%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2">è‡ªåŠ¨éƒ¨ç½²</a></p><p>100è¡Œå®ç°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> dotenv = <span class="built_in">require</span>(<span class="string">&quot;dotenv&quot;</span>)</span><br><span class="line">dotenv.<span class="title function_">config</span>()</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> &#123; <span class="title class_">Buffer</span> &#125; = <span class="built_in">require</span>(<span class="string">&#x27;buffer&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> childrenProcess = <span class="built_in">require</span>(<span class="string">&#x27;child_process&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&#x27;crypto&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> port = <span class="number">80</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">HUB_SECRET</span> = process.<span class="property">env</span>.<span class="property">HUB_SECRET</span>;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æ‰§è¡Œå‘½ä»¤ */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">exec</span> = (<span class="params">bash</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ”§ å¼€å§‹æ‰§è¡Œå‘½ä»¤ <span class="subst">$&#123;bash&#125;</span>`</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    childrenProcess.<span class="title function_">exec</span>(bash, <span class="function">(<span class="params">error, stdout, stderr</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (error) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">`ğŸ”§ å‘½ä»¤å‡ºé”™ <span class="subst">$&#123;bash&#125;</span> exec error: <span class="subst">$&#123;error&#125;</span>`</span>);</span><br><span class="line">        <span class="title function_">reject</span>()</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`ğŸ”§ å‘½ä»¤å®Œæˆ <span class="subst">$&#123;bash&#125;</span> stdout: <span class="subst">$&#123;stdout&#125;</span> stderr: <span class="subst">$&#123;stderr&#125;</span>`</span>);</span><br><span class="line">      <span class="title function_">resolve</span>()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** æ ¡éªŒsig */</span></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">validateHubSig</span> = (<span class="params">req</span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!req.<span class="property">body</span>) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    <span class="keyword">const</span> signature = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(<span class="string">`sha1=<span class="subst">$&#123;crypto.createHmac(<span class="string">&#x27;sha1&#x27;</span>, HUB_SECRET).update(<span class="built_in">JSON</span>.stringify(req.body)).digest(<span class="string">&#x27;hex&#x27;</span>)&#125;</span>`</span>)</span><br><span class="line">    <span class="keyword">const</span> _signature = <span class="title class_">Buffer</span>.<span class="title function_">from</span>(req.<span class="property">headers</span>[<span class="string">&#x27;x-hub-signature&#x27;</span>])</span><br><span class="line">    <span class="keyword">if</span> (signature.<span class="property">length</span> !== _signature.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> crypto.<span class="title function_">timingSafeEqual</span>(signature, _signature)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">error</span>(<span class="string">&#x27;validateHubSigFail&#x27;</span>, error)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/** é™æ€èµ„æº */</span></span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;./public&#x27;</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">/** webhook - è‡ªåŠ¨åˆ·æ–° */</span></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/refresh&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="title function_">validateHubSig</span>(req)) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸ‚ webhookè‡ªåŠ¨åˆ·æ–°è§¦å‘ï¼Œæ­£åœ¨æ‰§è¡Œ...&#x27;</span>)</span><br><span class="line">    <span class="title function_">exec</span>(<span class="string">&#x27;git pull&#x27;</span>)</span><br><span class="line">      .<span class="title function_">then</span>(exec.<span class="title function_">bind</span>(<span class="variable language_">this</span>, <span class="string">&#x27;npm install&#x27;</span>))</span><br><span class="line">      .<span class="title function_">then</span>(exec.<span class="title function_">bind</span>(<span class="variable language_">this</span>, <span class="string">&#x27;npm run build&#x27;</span>))</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;ğŸ‰ è‡ªåŠ¨åˆ·æ–°å®Œæˆ!&#x27;</span>)</span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;âŒ è‡ªåŠ¨åˆ·æ–°å¤±è´¥ï¼Œè¯·æŸ¥çœ‹æ—¥å¿—è¯¦æƒ…!&#x27;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">    res.<span class="title function_">status</span>(<span class="number">200</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">      <span class="attr">msg</span>:<span class="string">&#x27;webhook success&#x27;</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  res.<span class="title function_">status</span>(<span class="number">400</span>).<span class="title function_">send</span>(&#123;</span><br><span class="line">    <span class="attr">msg</span>: <span class="string">&#x27;validate signature fail&#x27;</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(port, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`app listening on port <span class="subst">$&#123;port&#125;</span>`</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å‰©ä¸‹å°±æ˜¯ç›´æ¥pushï¼Œå†ä¹Ÿä¸ç”¨ä¸Šæœºå™¨äº†ï¼ˆå½“ç„¶æœ‰BUGè¿˜æ˜¯è¦å»çš„ ğŸ˜…ï¼‰</p>]]></content>
      
      
      <categories>
          
          <category> åŸºç¡€ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> æ•™ç¨‹ </tag>
            
            <tag> Hexo </tag>
            
            <tag> åŸºç¡€æ•™ç¨‹ </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
